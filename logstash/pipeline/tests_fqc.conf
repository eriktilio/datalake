# Configuração de entrada (input) para o plugin File, que permite a leitura de dados de um arquivo de csv.
input {
  file {
    # O caminho do diretório contendo os arquivos de csv.
    path => "/files/csv/*FQC*.csv"
    
    # A posição inicial a partir da qual o Logstash começará a ler os arquivos de csv.
    start_position => "beginning"
    
    # O caminho para o sincedb, um banco de dados de estado para rastrear a posição dos arquivos de csv.
    sincedb_path => "/dev/null"
    
    # Uma identificação única para este input, que pode ser útil para gerenciamento e depuração.
    id => "test_fqc"
    
    # Adiciona um campo "index" aos eventos, útil para especificar o índice no Elasticsearch.
    add_field => {"index" => "test_fqc"}
  }
}

# Configuração do filtro (filter) para processar os eventos lidos do arquivo de csv.
filter {
  csv {
    separator => ","
    columns => ["Work Date", "Work Time", "Lot No", "Qc Times", "Qc Result", "Process Name", "Work Order", "Part No", "Sampling Type", "Lot Size", "Sample Qty", "Fail Qty", "Fail Rate(%)", "LOT_MEMO"]
    skip_header => true
  }

  # Adicione o filtro date para o campo Work Date
  date {
    match => ["Work Date", "yyyy/MM/dd"]
    target => "Work Date"
  }

  # Substitua os campos específicos por "N/A" se contiverem apenas espaços em branco
  if [Sampling Type] =~ /^\s*$/ {
    mutate {
      replace => { "Sampling Type" => "N/A" }
    }
  }
  if [LOT_MEMO] =~ /^\s*$/ {
    mutate {
      replace => { "LOT_MEMO" => "N/A" }
    }
  }
}

# Configuração de saída (output) para enviar os dados processados para o Elasticsearch e para a saída padrão (stdout).
output {
  # Configuração de saída para o Elasticsearch, especificando o endereço, usuário, senha, índice e codec.
  elasticsearch {
    hosts => "${ELASTIC_HOST}"
    user => "${ELASTIC_USER}"
    password => "${ELASTIC_PASSWORD}"
    index => "test_fqc"
    document_id => "%{Work Order}"

    # O codec a ser utilizado para codificar os eventos, neste caso, JSON.
    codec => json
  }
  
  # Configuração de saída para a saída padrão (console), utilizando o codec RubyDebug para formatar a saída.
  stdout {
    codec => rubydebug
  }
}
